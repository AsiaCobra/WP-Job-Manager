jQuery(function(e){e(".wp-job-manager-file-upload").each(function(){e(this).fileupload({dataType:"json",dropZone:e(this),url:job_manager_ajax_file_upload.ajax_url.toString().replace("%%endpoint%%","upload_file"),formData:{script:!0},add:function(a,t){var i=e(this),r=i.closest("form"),l=i.parent().find(".job-manager-uploaded-files"),n=[],o=!1,d=parseInt(i.data("file_limit"),10);if(void 0!==i.data("file_limit_left")?o=parseInt(i.data("file_limit_left"),10):void 0!==d&&(o=d-parseInt(l.children(".job-manager-uploaded-file").length,10),i.data("file_limit_left",o)),!1!==o&&o<=0){var s="Exceeded upload limit";i.data("file_limit_message")?s=i.data("file_limit_message"):"undefined"!=typeof job_manager_job_submission&&(s=job_manager_job_submission.i18n_over_upload_limit),s=s.replace("%d",d),n.push(s)}var p=e(this).data("file_types");if(p){var f=new RegExp("(.|/)("+p+")$","i");t.originalFiles[0].name.length&&!f.test(t.originalFiles[0].name)&&n.push(job_manager_ajax_file_upload.i18n_invalid_file_type+" "+p)}n.length>0?window.alert(n.join("\n")):(!1!==o&&i.data("file_limit_left",o-1),r.find(':input[type="submit"]').attr("disabled","disabled"),t.context=e('<progress value="" max="100"></progress>').appendTo(l),t.submit())},progress:function(e,a){var t=parseInt(a.loaded/a.total*100,10);a.context.val(t)},fail:function(a,t){var i=e(this),r=i.closest("form");t.errorThrown&&window.alert(t.errorThrown),t.context.remove(),r.find(':input[type="submit"]').removeAttr("disabled"),i.trigger("update_status")},done:function(a,t){var i=e(this),r=i.closest("form"),l=i.parent().find(".job-manager-uploaded-files"),n=i.attr("multiple")?1:0,o=["jpg","gif","png","jpeg","jpe"];t.context.remove(),void 0===t.result.success||t.result.success||window.alert(t.result.data),e.each(t.result.files,function(a,t){if(t.error)window.alert(t.error);else{var r;e.inArray(t.extension,o)>=0?(r=e.parseHTML(job_manager_ajax_file_upload.js_field_html_img),e(r).find(".job-manager-uploaded-file-preview img").attr("src",t.url)):(r=e.parseHTML(job_manager_ajax_file_upload.js_field_html),e(r).find(".job-manager-uploaded-file-name code").text(t.name)),e(r).find(".input-text").val(t.url),e(r).find(".input-text").attr("name","current_"+i.attr("name")),n?l.append(r):l.html(r)}}),r.find(':input[type="submit"]').removeAttr("disabled"),i.trigger("update_status")}})})});